package uk.co.awe.pmat.gui.graph;

import java.awt.GridBagConstraints;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.util.Map;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.border.EmptyBorder;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import uk.co.awe.pmat.graph.GraphConfig;
import uk.co.awe.pmat.gui.GuiPanel;

/**
 * A panel for displaying labels used in the graph and allowing them to be
 * renamed.
 * 
 * @author AWE Plc copyright 2013
 */
public final class GraphLabelPanel extends GuiPanel {

	private final GraphConfig graphConfig;
	private final GridBagConstraints gbc;
	private final JPanel spacer;

	/**
	 * Create a new {@code GraphLabelPanel}.
	 * 
	 * @param graphConfig
	 *            the model driving this panel.
	 */
	public GraphLabelPanel(GraphConfig graphConfig) {
		initComponents();

		this.graphConfig = graphConfig;
		graphConfig.addChangeListener((ChangeListener) this);

		spacer = new JPanel();
		gbc = new GridBagConstraints(0, GridBagConstraints.RELATIVE, // grid x,
																		// y
				1, 1, // grid width, height
				1.0, 0.0, // weight x, y
				GridBagConstraints.CENTER, // anchor
				GridBagConstraints.BOTH, // fill
				new Insets(0, 0, 0, 0), // insets
				0, 0); // pad x, y

		updatePanels();
	}

	@Override
	public void stateChanged(ChangeEvent e) {
		updatePanels();
	}

	/**
	 * Update the displayed labels.
	 */
	private void updatePanels() {
		optionPanels.removeAll();
		gbc.weighty = 0.0;
		optionPanels.add(createHeaderPanel(), gbc);
		for (Map.Entry<String, String> option : graphConfig.getGraphLabels()
				.entrySet()) {
			OptionPanel op = new OptionPanel(option.getKey(), option.getValue());
			optionPanels.add(op, gbc);
		}
		gbc.weighty = 1.0;
		optionPanels.add(spacer, gbc);
		optionPanels.revalidate();
		optionPanels.repaint();
	}

	/**
	 * Create the header panel.
	 * 
	 * @return the header panel.
	 */
	private JPanel createHeaderPanel() {
		final JPanel optionLabels = new JPanel(new GridLayout(1, 2, 10, 10));
		final JLabel optionLabel = new JLabel("Rename From:");
		final JLabel renameLabel = new JLabel("Rename To:");

		optionLabel.setBorder(new EmptyBorder(0, 5, 5, 0));
		renameLabel.setBorder(new EmptyBorder(0, 5, 5, 0));

		optionLabels.add(optionLabel);
		optionLabels.add(renameLabel);

		return optionLabels;
	}

	/**
	 * A {@code JPanel} which displays a label and updates the model whenever
	 * the "Rename To:" text is changed.
	 */
	private class OptionPanel extends JPanel {

		private final JTextField optionField;
		private final JTextField renameField;

		/**
		 * Create a new {@code OptionPanel}.
		 * 
		 * @param optionText
		 *            the text to rename.
		 * @param renameText
		 *            the rename value.
		 */
		OptionPanel(String optionText, String renameText) {
			super(new GridLayout(1, 2, 10, 10));
			setName(renameText);

			optionField = new JTextField(optionText);
			renameField = new JTextField(renameText);

			optionField.setEditable(false);
			optionField.setFocusable(false);
			renameField.addFocusListener(new FocusAdapter() {
				@Override
				public void focusLost(FocusEvent e) {
					graphConfig.setGraphLabel(optionField.getText(),
							renameField.getText());
				}
			});

			add(optionField);
			add(renameField);
		}
	}

	/**
	 * This method is called from within the constructor to initialise the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed"
	// desc="Generated Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		setLayout(new java.awt.GridLayout(1, 0));

		optionPanels.setBorder(javax.swing.BorderFactory.createEmptyBorder(10,
				10, 10, 10));
		optionPanels.setLayout(new java.awt.GridBagLayout());
		scrollPane.setViewportView(optionPanels);

		add(scrollPane);
	}// </editor-fold>//GEN-END:initComponents

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private final javax.swing.JPanel optionPanels = new javax.swing.JPanel();
	private final javax.swing.JScrollPane scrollPane = new javax.swing.JScrollPane();
	// End of variables declaration//GEN-END:variables

}
